import{_ as P,o as R,a as c,c as f,b as i,t as O,d as l,w as r,h as g,i as n,j as q,m as z,u as G,e as v,F as I,r as k,g as y,E as m,k as J}from"./index-BOupgZvc.js";import{M as K}from"./index-_Dy2zPzC.js";import{b as Q,u as x,c as C}from"./article-DBlYbpKZ.js";import{g as W}from"./category-DCVvt8l0.js";import{g as X}from"./tag-BgUr4tH5.js";import"./request-sz1W-oIh.js";const Y={class:"card p-6"},Z={class:"flex items-center justify-between mb-5"},$={class:"text-lg font-semibold",style:{color:"var(--text-primary)"}},ee=["src"],te={class:"editor-container"},oe={class:"editor"},le={class:"preview"},ae=["innerHTML"],se={__name:"ArticleEdit",setup(re){const M=q(),A=G(),E=new K,p=g(!1),w=g([]),b=g([]),e=z({id:null,title:"",summary:"",content:"",coverImage:"",categoryId:null,tagIds:[],status:1}),L=J(()=>e.content?E.render(e.content):""),T=async()=>{try{const t=await W();w.value=t.data||[]}catch(t){console.error("获取分类失败:",t)}},U=async()=>{try{const t=await X();b.value=t.data||[]}catch(t){console.error("获取标签失败:",t)}},B=async()=>{var o,d;const t=M.params.id;if(t){p.value=!0,e.id=t;try{const s=(await Q(t)).data;Object.assign(e,{id:s.id,title:s.title,summary:s.summary,content:s.content,coverImage:s.coverImage,categoryId:(o=s.category)==null?void 0:o.id,tagIds:((d=s.tags)==null?void 0:d.map(_=>_.id))||[]})}catch(u){console.error("获取文章失败:",u)}}},S=t=>{t.code===200&&(e.coverImage=t.data.url)},h=async()=>{if(!e.title.trim()){m.warning("请输入文章标题");return}if(!e.content.trim()){m.warning("请输入文章内容");return}try{e.status=1,p.value?(await x(e.id,e),m.success("文章更新成功")):(await C(e),m.success("文章发布成功")),A.push("/admin/articles")}catch(t){console.error("发布文章失败:",t)}},j=async()=>{try{e.status=0,p.value?await x(e.id,e):await C(e),m.success("草稿保存成功")}catch(t){console.error("保存草稿失败:",t)}};return R(()=>{T(),U(),B()}),(t,o)=>{const d=n("el-button"),u=n("el-input"),s=n("el-form-item"),_=n("el-option"),V=n("el-select"),D=n("Plus"),F=n("el-icon"),N=n("el-upload"),H=n("el-form");return c(),f("div",null,[i("div",Y,[i("div",Z,[i("h3",$,O(p.value?"编辑文章":"创建文章"),1),l(d,{type:"primary",onClick:h},{default:r(()=>[...o[5]||(o[5]=[v("发布",-1)])]),_:1})]),l(H,{model:e,"label-width":"80px"},{default:r(()=>[l(s,{label:"标题"},{default:r(()=>[l(u,{modelValue:e.title,"onUpdate:modelValue":o[0]||(o[0]=a=>e.title=a),placeholder:"请输入文章标题",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"分类"},{default:r(()=>[l(V,{modelValue:e.categoryId,"onUpdate:modelValue":o[1]||(o[1]=a=>e.categoryId=a),placeholder:"请选择分类"},{default:r(()=>[(c(!0),f(I,null,k(w.value,a=>(c(),y(_,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"标签"},{default:r(()=>[l(V,{modelValue:e.tagIds,"onUpdate:modelValue":o[2]||(o[2]=a=>e.tagIds=a),multiple:"",placeholder:"请选择标签","allow-create":"",filterable:""},{default:r(()=>[(c(!0),f(I,null,k(b.value,a=>(c(),y(_,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"封面图"},{default:r(()=>[l(N,{class:"cover-uploader",action:"/api/v1/upload/image","show-file-list":!1,"on-success":S},{default:r(()=>[e.coverImage?(c(),f("img",{key:0,src:e.coverImage,class:"cover"},null,8,ee)):(c(),y(F,{key:1,class:"uploader-icon"},{default:r(()=>[l(D)]),_:1}))]),_:1})]),_:1}),l(s,{label:"摘要"},{default:r(()=>[l(u,{modelValue:e.summary,"onUpdate:modelValue":o[3]||(o[3]=a=>e.summary=a),type:"textarea",rows:3,placeholder:"请输入文章摘要",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"内容"},{default:r(()=>[i("div",te,[i("div",oe,[l(u,{modelValue:e.content,"onUpdate:modelValue":o[4]||(o[4]=a=>e.content=a),type:"textarea",rows:20,placeholder:"使用 Markdown 格式编写内容"},null,8,["modelValue"])]),i("div",le,[i("div",{class:"preview-content prose",innerHTML:L.value},null,8,ae)])])]),_:1}),l(s,null,{default:r(()=>[l(d,{type:"primary",onClick:h},{default:r(()=>[...o[6]||(o[6]=[v("发布",-1)])]),_:1}),l(d,{onClick:j},{default:r(()=>[...o[7]||(o[7]=[v("保存草稿",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])}}},pe=P(se,[["__scopeId","data-v-81c24e47"]]);export{pe as default};
